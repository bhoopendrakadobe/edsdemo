/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as a,Fragment as E,jsx as e}from"@dropins/tools/preact-jsx-runtime.js";import{classes as Ce}from"@dropins/tools/lib.js";import{Modal as xe,Price as pe,ContentGrid as _e,ImageSwatch as be,Button as ae,Skeleton as Pe,SkeletonRow as Me,Field as X,Checkbox as de,Input as Oe,TextArea as Ne,Accordion as Ge,AccordionSection as ye,Icon as Y,Card as Te,ProgressSpinner as We}from"@dropins/tools/components.js";/* empty css                   */import*as D from"@dropins/tools/preact-compat.js";import{useState as N,useEffect as ee,useCallback as U,useMemo as he}from"@dropins/tools/preact-hooks.js";import{useText as J}from"@dropins/tools/i18n.js";import{s as A}from"../chunks/resetCart.js";import{S as Fe}from"../chunks/ChevronUp.js";import{S as we}from"../chunks/ChevronDown.js";import{events as Re}from"@dropins/tools/event-bus.js";import{u as Ve}from"../chunks/updateProductsFromCart.js";import{s as $e}from"../chunks/setGiftOptionsOnCart.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/persisted-data.js";import"../chunks/refreshCart.js";import"../fragments.js";import"../chunks/acdl.js";const se=r=>D.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},D.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),D.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),ce=r=>D.createElement("svg",{width:20,height:23,viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},D.createElement("path",{d:"M10 6L10 21.5M10 6H12.25C13.4926 6 14.5 4.99264 14.5 3.75C14.5 2.50736 13.4926 1.5 12.25 1.5C11.0074 1.5 10 2.50736 10 3.75M10 6V3.75M10 6H7.75C6.50736 6 5.5 4.99264 5.5 3.75C5.5 2.50736 6.50736 1.5 7.75 1.5C8.99264 1.5 10 2.50736 10 3.75M3.25 10.75H16.75C17.9926 10.75 19 9.74264 19 8.5C19 7.25736 17.9926 6.25 16.75 6.25H3.25C2.00736 6.25 1 7.25736 1 8.5C1 9.74264 2.00736 10.75 3.25 10.75ZM4.75 21.5H15.25C16.4926 21.5 17.5 20.4926 17.5 19.25V13.25C17.5 12.0074 16.4926 11 15.25 11H4.75C3.50736 11 2.5 12.0074 2.5 13.25V19.25C2.5 20.4926 3.50736 21.5 4.75 21.5Z",stroke:"currentColor",strokeWidth:1.5})),ke=({view:r,showModal:i,productName:c,giftWrappingConfig:l,setShowModal:t,updateGiftOptions:f})=>{var p;const d=J({modalTitle:"Cart.GiftOptions.modal.title",defaultTitle:"Cart.GiftOptions.modal.defaultTitle",modalWrappingText:"Cart.GiftOptions.modal.wrappingText",modalWrappingSubText:"Cart.GiftOptions.modal.wrappingSubText",modalConfirmButton:"Cart.GiftOptions.modal.modalConfirmButton",modalCancelButton:"Cart.GiftOptions.modal.modalCancelButton"}),[o,g]=N();if(ee(()=>{g(l.find(n=>n.selected)??l[0])},[l]),!i||!l.length)return null;const h=c?`${d.modalTitle} ${c}`:d.defaultTitle;return a(xe,{"data-testid":`gift-option-modal-${r}`,className:"cart-gift-options-view__modal",size:"medium",title:a(E,{children:[e("span",{children:h}),o&&((p=o==null?void 0:o.price)==null?void 0:p.value)>0?e(pe,{amount:o.price.value,currency:o.price.currency,weight:"normal"}):null]}),centered:!0,onClose:()=>t(!1),children:[a("div",{className:"cart-gift-options-view__modal-content",children:[e("span",{className:"cart-gift-options-view__modal-text",children:d.modalWrappingText}),e(_e,{emptyGridContent:e(E,{}),maxColumns:6,columnWidth:"100px",className:"cart-gift-options-view__modal-grid",children:l.map(n=>e(be,{selected:(o==null?void 0:o.uid)===(n==null?void 0:n.uid),onValue:()=>{g(n)},name:"giftWrappingId",value:n.uid,src:n.image.url,alt:n.image.design,label:n.image.design,className:"cart-gift-options-view__modal-grid-item"},n.uid))}),e("span",{className:"cart-gift-options-view__modal-sub-text",children:o==null?void 0:o.design})]}),e(ae,{type:"button",onClick:()=>{f("giftWrappingId",o==null?void 0:o.uid,{giftOptionsWrap:!0}),t(!1)},children:d.modalConfirmButton}),e(ae,{type:"button",variant:"secondary",onClick:()=>t(!1),children:d.modalCancelButton})]})},Se=()=>e(Pe,{children:e(Me,{variant:"row",size:"small",fullWidth:!0,lines:1,multilineGap:"small"})}),Ae=({className:r,view:i,item:c,giftOptions:l,disabled:t,onInputChange:f,cartData:d,giftWrappingConfig:o,setShowModal:g,setFormVisibility:h})=>{var W,Z,re,te,ie,S,ne,Q;const p=J({customize:`Cart.GiftOptions.${i}.customize`,giftReceiptIncludedTitle:`Cart.GiftOptions.${i}.giftReceiptIncluded.title`,giftReceiptIncludedText:`Cart.GiftOptions.${i}.giftReceiptIncluded.subtitle`,printedCardIncludedTitle:`Cart.GiftOptions.${i}.printedCardIncluded.title`,printedCardIncludedText:`Cart.GiftOptions.${i}.printedCardIncluded.subtitle`,giftOptionsWrapTitle:`Cart.GiftOptions.${i}.giftOptionsWrap.title`,giftOptionsWrapText:`Cart.GiftOptions.${i}.giftOptionsWrap.subtitle`,requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),n=i==="product",_=(c==null?void 0:c.productGiftWrapping)??[],y=(d==null?void 0:d.cartGiftWrapping)??[],w=n?_:y,v=(W=d==null?void 0:d.items)==null?void 0:W.every(b=>b.giftWrappingAvailable),C=w.find(b=>b.uid===l.giftWrappingId),u=(C==null?void 0:C.design)??"",x=(Z=A.config)==null?void 0:Z.allowGiftWrappingOnOrder,R=(re=A.config)==null?void 0:re.allowGiftReceipt,I=(te=A.config)==null?void 0:te.allowPrintedCard,H=c==null?void 0:c.giftWrappingAvailable,V=c==null?void 0:c.giftWrappingPrice,O=n?!1:R,j=n?!1:I,K=n?H&&o.length:x&&o.length&&v,L=u?`${p.giftOptionsWrapText} ${u}`:"",G=+(((S=(ie=A.config)==null?void 0:ie.printedCardPrice)==null?void 0:S.value)??0)>0?(ne=A.config)==null?void 0:ne.printedCardPrice:null;let B=null;V!=null&&V.value?B=V:(Q=C==null?void 0:C.price)!=null&&Q.value&&(B=C.price);const q=!O&&!j&&!K;ee(()=>{h(b=>({...b,checkboxGroup:!q}))},[q,h]);const z=b=>b?a("span",{children:["Â (+",e(pe,{amount:b.value,currency:b.currency,weight:"normal"}),")"]}):null;return a("div",{className:Ce([r,[`${r}--hidden`,q]]),children:[O?e(X,{disabled:t,className:"cart-gift-options-view__field-gift-receipt",children:e(de,{disabled:t,name:"giftReceiptIncluded",checked:l.giftReceiptIncluded,placeholder:p.giftReceiptIncludedTitle,label:p.giftReceiptIncludedTitle,description:p.giftReceiptIncludedText,onChange:f})}):null,j?e(X,{disabled:t,className:"cart-gift-options-view__field-printed-card",children:e(de,{disabled:t,name:"printedCardIncluded",checked:l.printedCardIncluded,placeholder:p.printedCardIncludedTitle,label:a(E,{children:[p.printedCardIncludedTitle,z(G)]}),description:p.printedCardIncludedText,onChange:f})}):null,K?a(E,{children:[e(X,{disabled:t,className:"cart-gift-options-view__field-gift-wrap",children:e(de,{disabled:t,name:"isGiftWrappingSelected",checked:l.isGiftWrappingSelected,placeholder:p.giftOptionsWrapTitle,label:a(E,{children:[p.giftOptionsWrapTitle,z(B)]}),description:L,onChange:f})}),e(ae,{disabled:t||!o.length,type:"button","data-testid":`gift-option-customize-${i}`,variant:"tertiary",onClick:()=>g(!0),children:p.customize})]}):null]})},le={recipientName:"",senderName:"",message:""},Ee={giftReceiptIncluded:!1,printedCardIncluded:!1,isGiftWrappingSelected:!1},ve=(r,i)=>{var l,t;if(!i)return(l=A.config)==null?void 0:l.allowGiftMessageOnOrder;const c=((t=A.config)==null?void 0:t.allowGiftMessageOnOrderItems)??"";return typeof(r==null?void 0:r.giftMessageAvailable)=="boolean"?r==null?void 0:r.giftMessageAvailable:c},Ie=({view:r,item:i,giftOptions:c,disabled:l,errorMessage:t,onInputChange:f,onBlur:d,setFormVisibility:o})=>{const g=J({formTitle:`Cart.GiftOptions.${r}.formContent.formTitle`,formTo:`Cart.GiftOptions.${r}.formContent.formTo`,formFrom:`Cart.GiftOptions.${r}.formContent.formFrom`,giftMessageTitle:`Cart.GiftOptions.${r}.formContent.giftMessageTitle`,formToPlaceholder:`Cart.GiftOptions.${r}.formContent.formToPlaceholder`,formFromPlaceholder:`Cart.GiftOptions.${r}.formContent.formFromPlaceholder`,formMessagePlaceholder:`Cart.GiftOptions.${r}.formContent.formMessagePlaceholder`}),h=ve(i,r==="product");return ee(()=>{o(p=>({...p,formFields:h}))},[h,o]),h?a(E,{children:[e("span",{children:g.formTitle}),a("div",{children:[e("span",{children:g.formTo}),e(X,{disabled:l,error:t.recipientName,children:e(Oe,{disabled:l,type:"text",name:"recipientName",value:c.recipientName,placeholder:g.formToPlaceholder,onChange:f,onBlur:d})})]}),a("div",{children:[e("span",{children:g.formFrom}),e(X,{disabled:l,error:t.senderName,children:e(Oe,{disabled:l,type:"text",name:"senderName",value:c.senderName,placeholder:g.formFromPlaceholder,onChange:f,onBlur:d})})]}),a("div",{children:[e("span",{children:g.giftMessageTitle}),e(X,{disabled:l,children:e(Ne,{errorMessage:t.message,disabled:l,name:"message",value:c.message,label:g.formMessagePlaceholder,onChange:f,onBlur:d})})]})]}):null},He=({view:r,giftOptions:i,giftWrappingConfig:c,readOnlyFormOrderView:l})=>{const t=J({readOnlyProductTitle:"Cart.GiftOptions.product.readOnlyFormView.title",wrapping:"Cart.GiftOptions.product.readOnlyFormView.wrapping",recipient:"Cart.GiftOptions.product.readOnlyFormView.recipient",sender:"Cart.GiftOptions.product.readOnlyFormView.sender",message:"Cart.GiftOptions.product.readOnlyFormView.message",readOnlyOrderTitle:"Cart.GiftOptions.order.readOnlyFormView.title",readOnlyOrderGiftReceiptTitle:"Cart.GiftOptions.order.readOnlyFormView.giftReceipt",readOnlyOrderGiftReceiptText:"Cart.GiftOptions.order.readOnlyFormView.giftReceiptText",readOnlyOrderGiftPrintCardTitle:"Cart.GiftOptions.order.readOnlyFormView.printCard",readOnlyOrderGiftPrintCardText:"Cart.GiftOptions.order.readOnlyFormView.printCardText",readOnlyOrderGiftWrapTitle:"Cart.GiftOptions.order.readOnlyFormView.giftWrap",readOnlyOrderGiftWrapOptionsText:"Cart.GiftOptions.order.readOnlyFormView.giftWrapOptions",readOnlyOrderFormTitle:"Cart.GiftOptions.order.readOnlyFormView.formTitle",readOnlyOrderFormTo:"Cart.GiftOptions.order.readOnlyFormView.formTo",readOnlyOrderFormFrom:"Cart.GiftOptions.order.readOnlyFormView.formFrom",readOnlyOrderFormMessageTitle:"Cart.GiftOptions.order.readOnlyFormView.formMessageTitle"}),{recipientName:f,senderName:d,message:o,giftReceiptIncluded:g,printedCardIncluded:h,isGiftWrappingSelected:p}=i,n=c.find(({uid:u})=>u===(i==null?void 0:i.giftWrappingId)),_=!!f||!!d||!!o,y=n==null?void 0:n.design,w=g||h||(n==null?void 0:n.selected),v=[{id:1,title:t.wrapping,message:p?y:""},{id:2,title:t.recipient,message:f},{id:3,title:t.sender,message:d},{id:4,title:t.message,message:o}],C=v.every(({message:u})=>!u);if(r==="product"&&!C)return e(Ge,{"data-testid":"gift-options-product",iconClose:Fe,iconOpen:we,actionIconPosition:"right",children:e(ye,{title:t.readOnlyProductTitle,showIconLeft:!0,iconLeft:ce,defaultOpen:!1,renderContentWhenClosed:!1,children:e("div",{children:v.filter(u=>u.message).map(u=>a("p",{children:[u.title," ",u.message]},u.id))})})});if(r==="order"&&(_||w)){const u=a("div",{className:"cart-gift-options-readonly__header",children:[e(Y,{source:ce,size:"24"}),e("span",{children:t.readOnlyOrderTitle})]}),x=a(E,{children:[g?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(Y,{source:se,size:"16"}),e("p",{children:t.readOnlyOrderGiftReceiptTitle}),e("p",{children:t.readOnlyOrderGiftReceiptText})]}):null,h?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(Y,{source:se,size:"16"}),e("p",{children:t.readOnlyOrderGiftPrintCardTitle}),e("p",{children:t.readOnlyOrderGiftPrintCardText})]}):null,n!=null&&n.selected?a("div",{className:"cart-gift-options-readonly__checkboxes",children:[e(Y,{source:se,size:"16"}),a("p",{children:[t.readOnlyOrderGiftWrapTitle," (+",e(pe,{amount:n.price.value,currency:n.price.currency,weight:"normal"}),")"]}),e("p",{children:`${t.readOnlyOrderGiftWrapOptionsText} ${n==null?void 0:n.design}`})]}):null]}),R=_?a("div",{className:"cart-gift-options-readonly__form",children:[e("div",{children:t.readOnlyOrderFormTitle}),a("div",{children:[a("p",{children:[e("span",{children:t.readOnlyOrderFormTo}),e("span",{children:f})]}),a("p",{children:[e("span",{children:t.readOnlyOrderFormFrom}),e("span",{children:d})]})]}),a("div",{children:[e("p",{children:t.readOnlyOrderFormMessageTitle}),e("p",{children:o})]})]}):null;return a(Te,{variant:l,children:[u,x,R]})}return null},Be=({item:r,view:i,loading:c,giftOptions:l,showModal:t,isEditable:f,errorsField:d,updateLoading:o,cartData:g,fieldsDisabled:h,isGiftOptionsApplied:p,giftWrappingConfig:n,readOnlyFormOrderView:_,onBlur:y,setShowModal:w,updateGiftOptions:v,onInputChange:C,handleFormMouseLeave:u})=>{const[x,R]=N({checkboxGroup:!0,formFields:!0}),I=J({accordionHeading:`Cart.GiftOptions.${i}.accordionHeading`}),H=U(V=>e(Ge,{"data-testid":"gift-options-product",iconClose:Fe,iconOpen:we,actionIconPosition:"right",children:e(ye,{title:a("div",{className:"cart-gift-options-view__icon--success",children:[e("span",{children:I.accordionHeading}),p?e(Y,{source:se,size:"16"}):null]}),showIconLeft:!0,iconLeft:ce,defaultOpen:p||V,renderContentWhenClosed:!0,children:a(E,{children:[e(Ae,{className:"cart-gift-options-view__top",view:i,item:r,giftOptions:l,disabled:h,onInputChange:C,cartData:g,giftWrappingConfig:n,setShowModal:w,setFormVisibility:R}),e("form",{className:"cart-gift-options-view__footer",onMouseLeave:u,children:e(Ie,{view:i,item:r,giftOptions:l,disabled:h,errorMessage:d,onInputChange:C,onBlur:y,setFormVisibility:R})})]})})}),[I.accordionHeading,p,i,r,l,h,C,g,n,w,u,d,y]);return!x.checkboxGroup&&!x.formFields?null:a("div",{id:"cart-gift-options-view",className:Ce(["cart-gift-options-view",`cart-gift-options-view--${i}`,["cart-gift-options-view--loading",o]]),children:[o?e(We,{className:"cart-gift-options-view__spinner"}):null,c?e(Se,{}):a(E,{children:[f?null:e("div",{className:"cart-gift-options-view--readonly",children:e(He,{view:i,giftOptions:l,giftWrappingConfig:n,readOnlyFormOrderView:_})}),e(ke,{view:i,productName:(r==null?void 0:r.name)??"",showModal:t,giftWrappingConfig:n,setShowModal:w,updateGiftOptions:v}),i==="product"&&f?H(!1):null,i==="order"&&f?e(Te,{variant:"secondary",children:H(!0)}):null]})]})},ze=({item:r,view:i,dataSource:c,initialLoading:l,handleItemsLoading:t,handleItemsError:f,onItemUpdate:d})=>{var Q,b,fe,ue,ge,me;const o=i==="product",g=J({requiredFieldError:"Cart.GiftOptions.formText.requiredFieldError"}),[h,p]=N(l),[n,_]=N(!1),[y,w]=N(!1),[v,C]=N(!1),[u,x]=N(!1),[R,I]=N(!1),[H,V]=N([]),[O,j]=N(null),[K,L]=N(le),[G,B]=N(()=>({giftWrappingId:"",...le,...Ee})),q=((Q=G.recipientName)==null?void 0:Q.trim())&&((b=G.senderName)==null?void 0:b.trim())&&((fe=G.message)==null?void 0:fe.trim()),z=!((ue=G.recipientName)!=null&&ue.trim())&&!((ge=G.senderName)!=null&&ge.trim())&&!((me=G.message)!=null&&me.trim()),W=U(async s=>{switch(_(i==="order"),w(!0),i){case"product":{t==null||t(r.uid,!0),f==null||f(r.uid);const{recipientName:m,senderName:T,message:F,giftWrappingId:$,isGiftWrappingSelected:P}=s,oe={gift_message:{to:m||"",from:T||"",message:F||""},gift_wrapping_id:P?$:null};await Ve([{uid:r.uid,quantity:r.quantity,giftOptions:oe}]).then(()=>{d==null||d({item:r})}).finally(()=>{t==null||t(r.uid,!1),w(!1),C(!1),_(!1)}).catch(k=>{console.warn(k)})}break;case"order":await $e(s).finally(()=>{w(!1),C(!1),_(!1)});break;default:console.error('Incorrect "view" prop value provided for GiftOptions container (storefront-cart)');break}},[f,t,r,d,i]),Z=U((s,m,T={})=>{B(F=>{const $=M=>M in F,P=M=>$(M)?F[M]:void 0;if(!(P(s)!==m||Object.keys(T).some(M=>P(M)!==T[M])))return F;const k={...F,[s]:m,...T};return!k.recipientName&&!k.senderName&&!k.message&&x(!0),(typeof m=="boolean"||["giftWrappingId","giftReceiptIncluded","printedCardIncluded"].includes(s))&&W(k),C(!0),k})},[W]),re=U(async()=>{console.log("MOUSE LEAVE!",y),!y&&(z&&u&&(L(le),x(!1),await W(G)),v&&q&&(x(!0),await W(G)))},[W,G,v,z,u,y]),te=U(async s=>{if(console.log("BLURR!",y),y)return;const{name:m,value:T}=s.target;L(F=>({...F,[m]:T.trim()?"":g.requiredFieldError})),z&&u&&(L(le),x(!1),await W(G)),v&&q&&await W(G)},[W,g,G,v,z,u,y]),ie=U(s=>{const m=s.target.name,T=s.target,F=T.type==="checkbox"?T.checked:T.value;Z(m,F)},[Z]);ee(()=>{if(o)return;const s=Re.on(c==="cart"?"cart/data":"order/data",m=>{j(m)},{eager:!0});return()=>{s==null||s.off()}},[c,o]);const S=he(()=>{var k;if(!O&&!r)return null;const s=o?r==null?void 0:r.productGiftWrapping.map(M=>({...M,price:r.giftWrappingPrice.value>0?r.giftWrappingPrice:M.price})):(O==null?void 0:O.cartGiftWrapping)||[],m=s==null?void 0:s.find(M=>M.selected),T=(m==null?void 0:m.uid)??((k=s[0])==null?void 0:k.uid),F=!!m,$=o?r==null?void 0:r.giftMessage:O==null?void 0:O.giftMessage,P=O==null?void 0:O.printedCardIncluded,oe=O==null?void 0:O.giftReceiptIncluded;return p(!1),{...r!=null&&r.uid?{itemId:r.uid}:{},...o?{}:{printedCardIncluded:P,giftReceiptIncluded:oe},...$,giftWrappingId:T,isGiftWrappingSelected:F,giftWrappingOptions:s}},[o,r,O]);ee(()=>{if(!S)return;const{giftWrappingOptions:s}=S;B(m=>{const T=$=>$ in m,F=Object.keys(S).reduce(($,P)=>T(P)&&m[P]!==S[P]?{...$,[P]:S[P]}:$,{});return Object.keys(F).length>0?{...m,...F}:m}),s!=null&&s.length&&V(s)},[S]);const ne=he(()=>Object.entries(G).filter(([s])=>s!=="itemId"&&s!=="giftWrappingId").some(([,s])=>!!s),[G]);return{loading:h,giftOptions:G,showModal:R,errorsField:K,updateLoading:n,cartData:O,fieldsDisabled:y,isGiftOptionsApplied:ne,giftWrappingConfig:H,handleFormMouseLeave:re,onInputChange:ie,updateGiftOptions:Z,setShowModal:I,handleBlur:te}},lr=({item:r,view:i="order",readOnlyFormOrderView:c="primary",dataSource:l="cart",isEditable:t=!0,initialLoading:f=!0,handleItemsLoading:d,handleItemsError:o,onItemUpdate:g})=>{const{loading:h,giftOptions:p,showModal:n,errorsField:_,updateLoading:y,cartData:w,isGiftOptionsApplied:v,fieldsDisabled:C,giftWrappingConfig:u,handleFormMouseLeave:x,updateGiftOptions:R,setShowModal:I,onInputChange:H,handleBlur:V}=ze({item:r,view:i,dataSource:l,initialLoading:f,handleItemsLoading:d,handleItemsError:o,onItemUpdate:g});if(A.config){const{allowGiftWrappingOnOrder:O,allowGiftWrappingOnOrderItems:j,allowGiftMessageOnOrder:K,allowGiftMessageOnOrderItems:L,allowGiftReceipt:G,allowPrintedCard:B}=A.config;if(i==="product"&&!L&&!j&&!ve(r,!0)||i==="order"&&!O&&!K&&!G&&!B)return null}return e(Be,{item:r,view:i,loading:h,onBlur:V,giftOptions:p,showModal:n,isEditable:t,errorsField:_,setShowModal:I,updateLoading:y,updateGiftOptions:R,cartData:w,isGiftOptionsApplied:v,fieldsDisabled:C,giftWrappingConfig:u,handleFormMouseLeave:x,readOnlyFormOrderView:c,onInputChange:H})};export{lr as GiftOptions,lr as default};
